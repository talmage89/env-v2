#!/usr/bin/env bash

# Global pre-push hook: block pushes to disallowed remotes.
# Configured via CAGE_GIT_PUSH_REMOTES env var (space-separated URL patterns).
# If unset or empty, all pushes are allowed.

REMOTE_URL="$2"

[[ -z "${CAGE_GIT_PUSH_REMOTES:-}" ]] && exit 0

for pattern in $CAGE_GIT_PUSH_REMOTES; do
    if [[ "$REMOTE_URL" == *"$pattern"* ]]; then
        exit 0
    fi
done

echo "pre-push: blocked push to $REMOTE_URL"
echo "allowed remotes: $CAGE_GIT_PUSH_REMOTES"
exit 1
